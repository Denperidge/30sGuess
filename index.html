<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" type="text/css" href="stylesheet.css">-->
    <script src="functions.js"></script>
    <style>
      body
      {
        font-family: sans-serif;
        background-color: #FFFFFF;
      }


      #header
      {
        top: 0;
        left: 0;

        padding: 25px;

        font-size: 50px;
        font-weight: bold;

        color: #FFFFFF;
        background-color: #1DB954;
      }

      #header img
      {
        /* The logo and the icon’s exclusion zone is equal to half the height of the icon */
        margin-left: 25px;
        height: 50px;
      }


      #logOut
      {
        font-size: 11px;
        text-decoration: underline;
        text-align: right;
        float: right;
        cursor: pointer;
        cursor: hand;
      }


      #display_image
      {
        margin: 0px 25px;

        float: left;

        width: 100px;
        height: 100px;
        overflow: hidden;
      }
      #display_image img
      {
        margin-top: 50%;
        margin-left: 50%;
        transform: translateY(-50%) translateX(-50%);
      }
    </style>
  </head>
  <body>
    <div id="header">
      Minigames for <img src="Spotify_Logo_RGB_White.png" alt="Spotify"/>
      <p id="logOut" onclick="logOut();">Log out</p>
    </div>

    <div id="body">

      <div id="welcome">
        <div id="display_image" style="float:left;"><img/></div>
        <h1 id="display_name">Welcome, </h1>
      </div>

    </div>


    <div id="footer">
    </div>
  </body>
  <script>
    var accessToken = localStorage.getItem("accessToken");
    if (accessToken != null)
    {
      getJSON("GET", "https://api.spotify.com/v1/me", ["Authorization: Bearer" + accessToken],
      function(json)
      { // Sucess
        console.log("Successful user info fetch");
        var user = json;
        if (user.display_name != null) document.getElementById("display_name").innerHTML += user.display_name;
        else
        {
          var username = user.href.replace("https://api.spotify.com/v1/users/", "");
          username = username[0].toUpperCase() + username.slice(1);
          document.getElementById("display_name").innerHTML += username;
        }
        document.getElementById("display_image").children[0].src = user.images[0].url;
      },
      function(json)
      {  // Failure
        console.log("Failing user info fetch");
        if (json.error.status == 401)
        {  // Invalid token
          askForAuthentication();
        }
        else
        {  // Unknown error
          console.log("An unkown error occurred!");
          console.log("STATUS: " + json.error.status + "\n" + "MESSAGE: " + json.error.message);
          console.log("Screenshot this and tell me what you did when this happenned at stijn.exe@gmail.com.");
          alert("An unknown error occurred! Press F12 and open your console and follow the instructions in the console.");
        }
      });
    }
    else askForAuthentication();

    function logOut()
    {
      localStorage.removeItem("accessToken");
      location.reload();
    }
  </script>
</html>
